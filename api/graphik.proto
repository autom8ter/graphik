syntax = "proto3";

package api;

option go_package = "apipb";

import "google/protobuf/struct.proto";
import "google/protobuf/timestamp.proto";
import "google/protobuf/any.proto";

enum Op {
  CREATE_NODE =0;
  PATCH_NODE =1;
  DELETE_NODE =2;
  CREATE_EDGE =3;
  PATCH_EDGE =4;
  DELETE_EDGE =5;
}

enum Keyword {
  ANY =0;
  DEFAULT =1;
}

message Command {
  Op op =1;
  google.protobuf.Any val =2;
  google.protobuf.Timestamp timestamp =3;
}

message Counter {
  int64 count =1;
}

message Path {
  string Type =1;
  string ID =2;
}

message NodeConstructor {
  Path path =1;
  google.protobuf.Struct attributes = 2;
}

message Node {
  Path path =1;
  google.protobuf.Struct attributes = 2;
  google.protobuf.Timestamp created_at =3;
  google.protobuf.Timestamp updated_at =4;
}

message Message {
  string channel =1;
  string type = 2;
  google.protobuf.Struct attributes = 3;
}

message Filter {
  string type =1;
  repeated string expressions =2;
  int32 limit =3;
}

message Export {
  repeated Node nodes =1;
  repeated Edge edges =2;
}

message Patch {
  Path path =1;
  google.protobuf.Struct patch = 2;
}

message EdgeConstructor {
  Path path =1;
  bool mutual =2;
  google.protobuf.Struct attributes = 3;
  Path from =4;
  Path to =5;
}

message Edge {
  Path path =1;
  bool mutual =2;
  google.protobuf.Struct attributes = 3;
  Path from =4;
  Path to =5;
  google.protobuf.Timestamp created_at =6;
  google.protobuf.Timestamp updated_at =7;
}

message EdgeFilters {
  repeated Filter edges_from =1;
  repeated Filter edges_to =2;
}

message JoinClusterRequest {
  string node_id =1;
  string address =2;
}

message JWKSSource {
  string uri =1;
  string issuer =2;
}

message JoinClusterResponse {}

message GetJWKSRequest {}

message GetJWKSResponse {
  repeated JWKSSource sources =1;
}

message UpdateJWKSRequest {
  repeated JWKSSource sources =1;
}

message UpdateJWKSResponse {
  repeated JWKSSource sources =1;
}

message CreateNodesRequest {
  repeated NodeConstructor nodes =1;
}

message CreateNodesResponse {
  repeated Node nodes =1;
}

message SearchNodesRequest {
    Filter filter =1;
}

message SearchNodesResponse {
  repeated Node nodes = 1;
}

message PatchNodesRequest {
  repeated Patch patches =1;
}

message PatchNodesResponse {
  repeated Node nodes =1;
}

message DelNodesRequest {
  repeated Path paths =1;
}

message DelNodesResponse {
  Counter counter =1;
}

message CreateEdgesRequest {
  repeated EdgeConstructor edges =1;
}

message CreateEdgesResponse {
  repeated Edge edges =1;
}

message SearchEdgesRequest {
  Filter filter =1;
}

message SearchEdgesResponse {
  repeated Edge edges = 1;
}

message PatchEdgesRequest {
  repeated Patch patches =1;
}

message PatchEdgesResponse {
  repeated Edge edges =1;
}

message DelEdgesRequest {
  repeated Path paths =1;
}

message DelEdgesResponse {
  Counter counter =1;
}

service PrivateService {
  rpc JoinCluster(JoinClusterRequest) returns(JoinClusterResponse) {}
  rpc GetJWKS(GetJWKSRequest) returns (GetJWKSResponse){}
  rpc UpdateJWKS(UpdateJWKSRequest) returns(UpdateJWKSResponse){}

  rpc CreateNodes(CreateNodesRequest) returns(CreateNodesResponse){}
  rpc SearchNodes(SearchNodesRequest) returns (SearchNodesResponse){}
  rpc PatchNodes(PatchNodesRequest) returns(PatchNodesResponse){}
  rpc DelNodes(DelNodesRequest) returns(DelNodesResponse){}

  rpc CreateEdges(CreateEdgesRequest) returns(CreateEdgesResponse){}
  rpc SearchEdges(SearchEdgesRequest) returns (SearchEdgesResponse){}
  rpc PatchEdges(PatchEdgesRequest) returns(PatchEdgesResponse){}
  rpc DelEdges(DelEdgesRequest) returns(DelEdgesResponse){}
}